version: "3"

services:
  # redis-node-0:
  #   image: docker.io/bitnami/redis-cluster:6.0-debian-10
  #   volumes:
  #     - redis-cluster_data-0:/bitnami/redis/data
  #   environment:
  #     - 'REDIS_PASSWORD=bitnami'
  #     - 'REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5'

  # redis-node-1:
  #   image: docker.io/bitnami/redis-cluster:6.0-debian-10
  #   volumes:
  #     - redis-cluster_data-1:/bitnami/redis/data
  #   environment:
  #     - 'REDIS_PASSWORD=bitnami'
  #     - 'REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5'

  # redis-node-2:
  #   image: docker.io/bitnami/redis-cluster:6.0-debian-10
  #   volumes:
  #     - redis-cluster_data-2:/bitnami/redis/data
  #   environment:
  #     - 'REDIS_PASSWORD=bitnami'
  #     - 'REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5'

  # redis-node-3:
  #   image: docker.io/bitnami/redis-cluster:6.0-debian-10
  #   volumes:
  #     - redis-cluster_data-3:/bitnami/redis/data
  #   environment:
  #     - 'REDIS_PASSWORD=bitnami'
  #     - 'REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5'

  # redis-node-4:
  #   image: docker.io/bitnami/redis-cluster:6.0-debian-10
  #   volumes:
  #     - redis-cluster_data-4:/bitnami/redis/data
  #   environment:
  #     - 'REDIS_PASSWORD=bitnami'
  #     - 'REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5'

  # redis-node-5:
  #   image: docker.io/bitnami/redis-cluster:6.0-debian-10
  #   volumes:
  #     - redis-cluster_data-5:/bitnami/redis/data
  #   environment:
  #     - 'REDIS_PASSWORD=bitnami'
  #     - 'REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5'

  # redis-cluster-init:
  #   image: docker.io/bitnami/redis-cluster:6.0-debian-10
  #   depends_on:
  #     - redis-node-0
  #     - redis-node-1
  #     - redis-node-2
  #     - redis-node-3
  #     - redis-node-4
  #     - redis-node-5
  #   environment:
  #     - 'REDISCLI_AUTH=bitnami'
  #     - 'REDIS_CLUSTER_REPLICAS=1'
  #     - 'REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5'
  #     - 'REDIS_CLUSTER_CREATOR=yes'

  redis:
    image: redis
    container_name: redis-driverservice
    restart: always
    ports:
      - 6379:6379
  driverservice:
    image: omvk97/bachelordriverservice
    container_name: driverservice
    environment:
      EXPRESS_PORT: 5001
      SOCKETIO_PORT: 5002
      REDIS_HOST: redis
      REDIS_PORT: 6379
      USE_COORDINATOR: "FALSE"
    ports:
      - 5001:5001
      - 5002:5002
    depends_on:
      - redis
  performance_monitoring:
    image: prom/prometheus
    container_name: prometheus
    ports:
      - 9090:9090
    volumes:
      - "./prometheus.yml:/etc/prometheus/prometheus.yml"
  grafana:
    image: grafana/grafana
    ports:
      - 3000:3000
      
networks:
  default:
    external:
      name: "dev-network"

volumes:
  redis-cluster_data-0:
    driver: local
  redis-cluster_data-1:
    driver: local
  redis-cluster_data-2:
    driver: local
  redis-cluster_data-3:
    driver: local
  redis-cluster_data-4:
    driver: local
  redis-cluster_data-5:
    driver: local